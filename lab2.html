<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–í—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –ø—Ä–∏–º—ñ—Ä–æ—á–Ω–∞</title>
    <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.5/dist/mindar-face-aframe.prod.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            overflow: hidden;
            background: #000;
        }

        .app-container {
            position: relative;
            width: 100vw;
            height: 100vh;
        }

        .ar-view {
            width: 100%;
            height: 100%;
        }

        /* –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è */
        .control-panel {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
            max-height: 40vh;
            overflow-y: auto;
            z-index: 10;
        }

        /* –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó –∞–∫—Å–µ—Å—É–∞—Ä—ñ–≤ */
        .category-tabs {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 8px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        .category-tab:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .category-tab.active {
            background: #4CAF50;
            border-color: #4CAF50;
        }

        /* –°–ø–∏—Å–æ–∫ –∞–∫—Å–µ—Å—É–∞—Ä—ñ–≤ */
        .accessories-grid {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
            scrollbar-width: thin;
            scrollbar-color: rgba(255, 255, 255, 0.3) transparent;
        }

        .accessories-grid::-webkit-scrollbar {
            height: 6px;
        }

        .accessories-grid::-webkit-scrollbar-thumb {
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
        }

        .accessory-item {
            flex-shrink: 0;
            width: 80px;
            height: 80px;
            border-radius: 15px;
            border: 3px solid transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            overflow: hidden;
            position: relative;
            background: rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .accessory-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .accessory-item .placeholder {
            color: white;
            font-size: 32px;
            opacity: 0.7;
        }

        .accessory-item:hover {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .accessory-item.selected {
            border-color: #4CAF50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.5);
        }

        .accessory-item.selected::after {
            content: '‚úì';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #4CAF50;
            color: white;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        /* –ö–Ω–æ–ø–∫–∏ –¥—ñ–π */
        .action-buttons {
            position: fixed;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .action-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .action-btn:hover {
            transform: scale(1.1);
            background: white;
        }

        .action-btn:active {
            transform: scale(0.95);
        }

        /* –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }

        .share-modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .captured-image {
            width: 100%;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .share-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .share-btn.primary {
            background: #4CAF50;
            color: white;
        }

        .share-btn.secondary {
            background: #f0f0f0;
            color: #333;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        /* –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 18px;
            z-index: 5;
        }

        /* –ê–¥–∞–ø—Ç–∏–≤–Ω—ñ—Å—Ç—å */
        @media (max-width: 600px) {
            .control-panel {
                padding: 15px;
            }

            .accessory-item {
                width: 60px;
                height: 60px;
            }

            .category-tab {
                padding: 6px 15px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="loading">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –∫–∞–º–µ—Ä–∏...</div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –¥—ñ–π -->
        <div class="action-buttons">
            <button class="action-btn" id="captureBtn" title="–ó—Ä–æ–±–∏—Ç–∏ –∑–Ω—ñ–º–æ–∫">üì∏</button>
            <button class="action-btn" id="resetBtn" title="–°–∫–∏–Ω—É—Ç–∏ –≤—Å–µ">üîÑ</button>
        </div>

        <!-- AR —Å—Ü–µ–Ω–∞ -->
        <div class="ar-view">
            <a-scene
                mindar-face
                embedded
                color-space="sRGB"
                renderer="colorManagement: true, physicallyCorrectLights"
                vr-mode-ui="enabled: false"
                device-orientation-permission-ui="enabled: false">
                
                <a-assets>
                    <!-- –ú–æ–¥–µ–ª—ñ –∞–∫—Å–µ—Å—É–∞—Ä—ñ–≤ -->
                    <a-asset-item id="headModel" src="https://cdn.jsdelivr.net/gh/hiukim/mind-ar-js@1.2.5/examples/face-tracking/assets/sparkar/headOccluder.glb"></a-asset-item>
                    
                    <!-- –û–∫—É–ª—è—Ä–∏ -->
                    <a-asset-item id="kaminaGlasses" src="./models/kamina_glasses.glb"></a-asset-item>
                    <a-asset-item id="glassesModel" src="./models/glasses.glb"></a-asset-item>
                    
                    <!-- –ö–∞–ø–µ–ª—é—Ö–∏ -->
                    <a-asset-item id="jotaroHat" src="./models/jotaro_hat.glb"></a-asset-item>
                    
                    <!-- –ê–∫—Å–µ—Å—É–∞—Ä–∏ –¥–ª—è —â–µ–ª–µ–ø–∏ -->
                    <a-asset-item id="lowerJaw" src="./models/lower_jaw.glb"></a-asset-item>
                    
                    <!-- –ö—ñ–±–µ—Ä—ñ–º–ø–ª–∞–Ω—Ç–∏ -->
                    <a-asset-item id="roboticEye" src="./models/robotic_eye.glb"></a-asset-item>
                    
                    <!-- –ñ–∞–∫–µ—Ç–∏ -->
                    <a-asset-item id="cyberpunkJacket" src="./models/cyberpunk_jacket.glb"></a-asset-item>
                    <a-asset-item id="regularJacket" src="./models/jacket.glb"></a-asset-item>
                    <a-asset-item id="rockJacket" src="./models/rock_jacket_mid-poly.glb"></a-asset-item>
                </a-assets>

                <a-camera active="false" position="0 0 0"></a-camera>

                <!-- –û–∫–ª—é–¥–µ—Ä –¥–ª—è –≥–æ–ª–æ–≤–∏ -->
                <a-entity mindar-face-target="anchorIndex: 168">
                    <a-gltf-model
                        mindar-face-occluder
                        position="0 -0.3 0.15"
                        rotation="0 0 0"
                        scale="0.065 0.065 0.065"
                        src="#headModel">
                    </a-gltf-model>
                </a-entity>

                <!-- –û–∫—É–ª—è—Ä–∏ -->
                <a-entity mindar-face-target="anchorIndex: 168">
                    <a-gltf-model
                        id="kamina-glasses"
                        rotation="0 0 0"
                        position="0 0 0"
                        scale="0.15 0.15 0.15"
                        src="#kaminaGlasses"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <a-entity mindar-face-target="anchorIndex: 168">
                    <a-gltf-model
                        id="regular-glasses"
                        rotation="0 0 0"
                        position="0 0 0"
                        scale="0.1 0.1 0.1"
                        src="#glassesModel"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <!-- –ö–∞–ø–µ–ª—é—Ö–∏ -->
                <a-entity mindar-face-target="anchorIndex: 10">
                    <a-gltf-model
                        id="jotaro-hat"
                        rotation="0 180 0"
                        position="0 0.3 0"
                        scale="0.2 0.2 0.2"
                        src="#jotaroHat"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <!-- –ê–∫—Å–µ—Å—É–∞—Ä–∏ –¥–ª—è —â–µ–ª–µ–ø–∏ (anchorIndex: 152 - –ø—ñ–¥–±–æ—Ä—ñ–¥–¥—è) -->
                <a-entity mindar-face-target="anchorIndex: 152">
                    <a-gltf-model
                        id="lower-jaw"
                        rotation="0 0 0"
                        position="0 -0.1 0"
                        scale="0.08 0.08 0.08"
                        src="#lowerJaw"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <!-- –ö—ñ–±–µ—Ä—ñ–º–ø–ª–∞–Ω—Ç–∏ –¥–ª—è –æ–∫–∞ (anchorIndex: 159 - –ª—ñ–≤–µ –æ–∫–æ) -->
                <a-entity mindar-face-target="anchorIndex: 159">
                    <a-gltf-model
                        id="robotic-eye"
                        rotation="0 0 0"
                        position="0 0 0"
                        scale="0.05 0.05 0.05"
                        src="#roboticEye"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <!-- –ñ–∞–∫–µ—Ç–∏ (anchorIndex: 5 - –æ—Å–Ω–æ–≤–∞ —à–∏—ó) -->
                <a-entity mindar-face-target="anchorIndex: 5">
                    <a-gltf-model
                        id="cyberpunk-jacket"
                        rotation="0 180 0"
                        position="0 -0.8 0"
                        scale="0.3 0.3 0.3"
                        src="#cyberpunkJacket"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <a-entity mindar-face-target="anchorIndex: 5">
                    <a-gltf-model
                        id="regular-jacket"
                        rotation="0 180 0"
                        position="0 -0.8 0"
                        scale="0.25 0.25 0.25"
                        src="#regularJacket"
                        visible="false">
                    </a-gltf-model>
                </a-entity>

                <a-entity mindar-face-target="anchorIndex: 5">
                    <a-gltf-model
                        id="rock-jacket"
                        rotation="0 180 0"
                        position="0 -0.8 0"
                        scale="0.3 0.3 0.3"
                        src="#rockJacket"
                        visible="false">
                    </a-gltf-model>
                </a-entity>
            </a-scene>
        </div>

        <!-- –ü–∞–Ω–µ–ª—å –∫–µ—Ä—É–≤–∞–Ω–Ω—è -->
        <div class="control-panel">
            <div class="category-tabs">
                <button class="category-tab active" data-category="all">–í—Å—ñ</button>
                <button class="category-tab" data-category="glasses">–û–∫—É–ª—è—Ä–∏</button>
                <button class="category-tab" data-category="hats">–ö–∞–ø–µ–ª—é—Ö–∏</button>
                <button class="category-tab" data-category="cybernetics">–ö—ñ–±–µ—Ä—ñ–º–ø–ª–∞–Ω—Ç–∏</button>
                <button class="category-tab" data-category="jackets">–ñ–∞–∫–µ—Ç–∏</button>
            </div>

            <div class="accessories-grid" id="accessoriesGrid">
                <!-- –î–∏–Ω–∞–º—ñ—á–Ω–æ –∑–∞–ø–æ–≤–Ω—é—î—Ç—å—Å—è -->
            </div>
        </div>

        <!-- –ú–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è -->
        <div class="share-modal" id="shareModal">
            <div class="modal-content">
                <h2>–í–∞—à–µ —Ñ–æ—Ç–æ –≥–æ—Ç–æ–≤–µ!</h2>
                <img class="captured-image" id="capturedImage" alt="–ó–Ω—ñ–º–æ–∫">
                <div class="share-buttons">
                    <button class="share-btn primary" id="downloadBtn">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
                    <button class="share-btn primary" id="shareBtn">–ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è</button>
                    <button class="share-btn secondary" id="closeModalBtn">–ó–∞–∫—Ä–∏—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // –î–∞–Ω—ñ –ø—Ä–æ –∞–∫—Å–µ—Å—É–∞—Ä–∏ –∑ –µ–º–æ–¥–∑—ñ —è–∫ –∑–∞–≥–ª—É—à–∫–∏ –¥–ª—è –º—ñ–Ω—ñ–∞—Ç—é—Ä
        const accessories = {
            glasses: [
                {
                    id: 'kamina-glasses',
                    name: '–û–∫—É–ª—è—Ä–∏ –ö–∞–º—ñ–Ω–∏',
                    emoji: 'ü•Ω',
                    modelId: '#kamina-glasses'
                },
                {
                    id: 'regular-glasses',
                    name: '–ó–≤–∏—á–∞–π–Ω—ñ –æ–∫—É–ª—è—Ä–∏',
                    emoji: 'üëì',
                    modelId: '#regular-glasses'
                }
            ],
            hats: [
                {
                    id: 'jotaro-hat',
                    name: '–ö–∞–ø–µ–ª—é—Ö –î–∂–æ—Ç–∞—Ä–æ',
                    emoji: 'üé©',
                    modelId: '#jotaro-hat'
                }
            ],
            cybernetics: [
                {
                    id: 'robotic-eye',
                    name: '–ö—ñ–±–µ—Ä–æ—á–∫–æ',
                    emoji: 'üëÅÔ∏è',
                    modelId: '#robotic-eye'
                },
                {
                    id: 'lower-jaw',
                    name: '–ö—ñ–±–µ—Ä—â–µ–ª–µ–ø–∞',
                    emoji: 'ü¶æ',
                    modelId: '#lower-jaw'
                }
            ],
            jackets: [
                {
                    id: 'cyberpunk-jacket',
                    name: '–ö—ñ–±–µ—Ä–ø–∞–Ω–∫ –∂–∞–∫–µ—Ç',
                    emoji: 'üß•',
                    modelId: '#cyberpunk-jacket'
                },
                {
                    id: 'regular-jacket',
                    name: '–ó–≤–∏—á–∞–π–Ω–∏–π –∂–∞–∫–µ—Ç',
                    emoji: 'üëî',
                    modelId: '#regular-jacket'
                },
                {
                    id: 'rock-jacket',
                    name: '–†–æ–∫ –∂–∞–∫–µ—Ç',
                    emoji: 'üé∏',
                    modelId: '#rock-jacket'
                }
            ]
        };

        // –°—Ç–∞–Ω –ø—Ä–æ–≥—Ä–∞–º–∏
        let activeCategory = 'all';
        let selectedAccessories = new Set();

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è
        document.addEventListener('DOMContentLoaded', () => {
            initializeApp();
            setupEventListeners();
            renderAccessories();
            
            // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –ø—ñ—Å–ª—è —Å—Ç–∞—Ä—Ç—É AR
            setTimeout(() => {
                document.querySelector('.loading').style.display = 'none';
            }, 2000);
        });

        // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è –ø—Ä–æ–≥—Ä–∞–º–∏
        function initializeApp() {
            // –í—Å—Ç–∞–Ω–æ–≤–∏—Ç–∏ –ø–æ—á–∞—Ç–∫–æ–≤—ñ –≤–∏–¥–∏–º–æ—Å—Ç—ñ
            Object.values(accessories).flat().forEach(accessory => {
                if (accessory.modelId) {
                    const entity = document.querySelector(accessory.modelId);
                    if (entity) entity.setAttribute('visible', false);
                } else if (accessory.modelIds) {
                    accessory.modelIds.forEach(modelId => {
                        const entity = document.querySelector(modelId);
                        if (entity) entity.setAttribute('visible', false);
                    });
                }
            });
        }

        // –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Å–ª—É—Ö–∞—á—ñ–≤ –ø–æ–¥—ñ–π
        function setupEventListeners() {
            // –ö–∞—Ç–µ–≥–æ—Ä—ñ—ó
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    activeCategory = tab.dataset.category;
                    updateCategoryTabs();
                    renderAccessories();
                });
            });

            // –ö–Ω–æ–ø–∫–∏ –¥—ñ–π
            document.getElementById('captureBtn').addEventListener('click', capturePhoto);
            document.getElementById('resetBtn').addEventListener('click', resetAll);
            document.getElementById('closeModalBtn').addEventListener('click', closeShareModal);
            document.getElementById('downloadBtn').addEventListener('click', downloadPhoto);
            document.getElementById('shareBtn').addEventListener('click', sharePhoto);
        }

        // –û–Ω–æ–≤–ª–µ–Ω–Ω—è –∞–∫—Ç–∏–≤–Ω–æ—ó –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
        function updateCategoryTabs() {
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.toggle('active', tab.dataset.category === activeCategory);
            });
        }

        // –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∞–∫—Å–µ—Å—É–∞—Ä—ñ–≤
        function renderAccessories() {
            const grid = document.getElementById('accessoriesGrid');
            grid.innerHTML = '';

            let itemsToShow = [];
            
            if (activeCategory === 'all') {
                itemsToShow = Object.values(accessories).flat();
            } else {
                itemsToShow = accessories[activeCategory] || [];
            }

            itemsToShow.forEach(accessory => {
                const item = document.createElement('div');
                item.className = 'accessory-item';
                item.dataset.accessoryId = accessory.id;
                
                if (selectedAccessories.has(accessory.id)) {
                    item.classList.add('selected');
                }

                item.innerHTML = accessory.thumbnail 
                    ? `<img src="${accessory.thumbnail}" alt="${accessory.name}" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"><div class="placeholder" style="display:none">${accessory.emoji || '?'}</div>`
                    : `<div class="placeholder">${accessory.emoji || '?'}</div>`;
                
                item.addEventListener('click', () => toggleAccessory(accessory));
                
                grid.appendChild(item);
            });
        }

        // –ü–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –∞–∫—Å–µ—Å—É–∞—Ä—É
        function toggleAccessory(accessory) {
            const isSelected = selectedAccessories.has(accessory.id);
            
            if (isSelected) {
                selectedAccessories.delete(accessory.id);
                hideAccessory(accessory);
            } else {
                // –í–∏–¥–∞–ª–∏—Ç–∏ —ñ–Ω—à—ñ –∞–∫—Å–µ—Å—É–∞—Ä–∏ —Ç—ñ—î—ó –∂ –∫–∞—Ç–µ–≥–æ—Ä—ñ—ó
                const category = Object.entries(accessories).find(([_, items]) => 
                    items.some(item => item.id === accessory.id)
                )?.[0];
                
                if (category) {
                    accessories[category].forEach(item => {
                        if (selectedAccessories.has(item.id)) {
                            selectedAccessories.delete(item.id);
                            hideAccessory(item);
                        }
                    });
                }
                
                selectedAccessories.add(accessory.id);
                showAccessory(accessory);
            }
            
            renderAccessories();
        }

        // –ü–æ–∫–∞–∑–∞—Ç–∏ –∞–∫—Å–µ—Å—É–∞—Ä
        function showAccessory(accessory) {
            if (accessory.modelId) {
                const entity = document.querySelector(accessory.modelId);
                if (entity) entity.setAttribute('visible', true);
            } else if (accessory.modelIds) {
                accessory.modelIds.forEach(modelId => {
                    const entity = document.querySelector(modelId);
                    if (entity) entity.setAttribute('visible', true);
                });
            }
        }

        // –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –∞–∫—Å–µ—Å—É–∞—Ä
        function hideAccessory(accessory) {
            if (accessory.modelId) {
                const entity = document.querySelector(accessory.modelId);
                if (entity) entity.setAttribute('visible', false);
            } else if (accessory.modelIds) {
                accessory.modelIds.forEach(modelId => {
                    const entity = document.querySelector(modelId);
                    if (entity) entity.setAttribute('visible', false);
                });
            }
        }

        // –°–∫–∏–Ω—É—Ç–∏ –≤—Å—ñ –∞–∫—Å–µ—Å—É–∞—Ä–∏
        function resetAll() {
            selectedAccessories.clear();
            Object.values(accessories).flat().forEach(accessory => {
                hideAccessory(accessory);
            });
            renderAccessories();
        }

        // –ó–∞—Ö–æ–ø–ª–µ–Ω–Ω—è —Ñ–æ—Ç–æ
        function capturePhoto() {
            const scene = document.querySelector('a-scene');
            const canvas = scene.components.screenshot.getCanvas('perspective');
            
            canvas.toBlob(blob => {
                const url = URL.createObjectURL(blob);
                document.getElementById('capturedImage').src = url;
                document.getElementById('shareModal').classList.add('active');
            }, 'image/png');
        }

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ
        function downloadPhoto() {
            const img = document.getElementById('capturedImage');
            const a = document.createElement('a');
            a.href = img.src;
            a.download = `virtual-try-on-${Date.now()}.png`;
            a.click();
        }

        // –ü–æ–¥—ñ–ª–∏—Ç–∏—Å—è —Ñ–æ—Ç–æ
        async function sharePhoto() {
            const img = document.getElementById('capturedImage');
            
            try {
                const response = await fetch(img.src);
                const blob = await response.blob();
                const file = new File([blob], 'virtual-try-on.png', { type: 'image/png' });

                if (navigator.share && navigator.canShare({ files: [file] })) {
                    await navigator.share({
                        title: '–ú–æ—è –≤—ñ—Ä—Ç—É–∞–ª—å–Ω–∞ –ø—Ä–∏–º—ñ—Ä–∫–∞',
                        text: '–ü–æ–¥–∏–≤—ñ—Ç—å—Å—è, —è–∫ –º–µ–Ω—ñ –ª–∏—á–∏—Ç—å!',
                        files: [file]
                    });
                } else {
                    // Fallback - –∫–æ–ø—ñ—é–≤–∞—Ç–∏ –ø–æ—Å–∏–ª–∞–Ω–Ω—è
                    alert('–í–∞—à –±—Ä–∞—É–∑–µ—Ä –Ω–µ –ø—ñ–¥—Ç—Ä–∏–º—É—î —Ñ—É–Ω–∫—Ü—ñ—é –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è. –ù–∞—Ç–æ–º—ñ—Å—Ç—å –≤–∏ –º–æ–∂–µ—Ç–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–æ—Ç–æ.');
                    downloadPhoto();
                }
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –ø—Ä–∏ —Å–ø—Ä–æ–±—ñ –ø–æ–¥—ñ–ª–∏—Ç–∏—Å—è:', error);
            }
        }

        // –ó–∞–∫—Ä–∏—Ç–∏ –º–æ–¥–∞–ª—å–Ω–µ –≤—ñ–∫–Ω–æ
        function closeShareModal() {
            document.getElementById('shareModal').classList.remove('active');
        }
    </script>
</body>
</html>
